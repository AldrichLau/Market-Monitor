color(~ price_YTD > 0, color = "#008000", ~ price_YTD) %>%
color(~ spread_chg < 0, color = "red", ~ spread_chg) %>%
color(~ spread_MTD < 0, color = "red", ~ spread_MTD) %>%
color(~ spread_YTD < 0, color = "red", ~ spread_YTD) %>%
color(~ spread_chg > 0, color = "#008000", ~ spread_chg) %>%
color(~ spread_MTD > 0, color = "#008000", ~ spread_MTD) %>%
color(~ spread_YTD > 0, color = "#008000", ~ spread_YTD) %>%
set_header_labels(Category = "", rating2 = "", Label = "",
price_chg = "涨跌幅", price_MTD = "涨跌幅",
price_YTD = "涨跌幅", spread_chg = "信用利差变动",
spread_MTD = "信用利差变动", spread_YTD = "信用利差变动") %>%
add_header_row(values = c("", "本周", "本月", "本年", "本周", "本月", "本年"),
top = FALSE) %>%
merge_at(i=1, j=2:4, part = "header") %>%
merge_at(i=1, j=5:7, part = "header") %>%
font(fontname = "Microsoft YaHei", part = "header") %>%
font(fontname = "Calibri", part = "body") %>%
fontsize(size = 10, part = "all") %>%
theme_vanilla() %>%
width(width = dim(.)$widths * page_width /(flextable_dim(.)$widths)) %>%
align(align="center", part="all") %>%
autofit()
return(ftout)
}
tran_kable1(Market$summary1[1], 6.5)
# html_table = property$summary1[1]
# html_table = Market$top[1]
# tran_kable1(html_table, 6.5, 1)
# 转换market$summary，mode1是单分组统计表，
# mode1是summary1，mode2是top&bottom
tran_kable1 <- function(html_table, page_width=6.5) {
ft <- as.data.frame(read_html(html_table) %>% html_table(fill=TRUE)) %>%
mutate(across(everything(), ~replace_na(.x, ""))) %>%
select(1, price_chg, price_MTD, price_YTD, spread_chg, spread_MTD,
spread_YTD)
ftout <- ft %>%
flextable() %>%
bold(part = 'all', bold = TRUE) %>%
color(~ price_chg < 0, color = "red", ~ price_chg) %>%
color(~ price_MTD < 0, color = "red", ~ price_MTD) %>%
color(~ price_YTD < 0, color = "red", ~ price_YTD) %>%
color(~ price_chg > 0, color = "#008000", ~ price_chg) %>%
color(~ price_MTD > 0, color = "#008000", ~ price_MTD) %>%
color(~ price_YTD > 0, color = "#008000", ~ price_YTD) %>%
color(~ spread_chg < 0, color = "red", ~ spread_chg) %>%
color(~ spread_MTD < 0, color = "red", ~ spread_MTD) %>%
color(~ spread_YTD < 0, color = "red", ~ spread_YTD) %>%
color(~ spread_chg > 0, color = "#008000", ~ spread_chg) %>%
color(~ spread_MTD > 0, color = "#008000", ~ spread_MTD) %>%
color(~ spread_YTD > 0, color = "#008000", ~ spread_YTD) %>%
set_header_labels(Category = "", rating2 = "", Label = "",
price_chg = "涨跌幅", price_MTD = "涨跌幅",
price_YTD = "涨跌幅", spread_chg = "信用利差变动",
spread_MTD = "信用利差变动", spread_YTD = "信用利差变动") %>%
add_header_row(values = c("分组", "本周", "本月", "本年", "本周", "本月", "本年"),
top = FALSE) %>%
merge_at(i=1, j=2:4, part = "header") %>%
merge_at(i=1, j=5:7, part = "header") %>%
font(fontname = "Microsoft YaHei", part = "header") %>%
font(fontname = "Calibri", part = "body") %>%
fontsize(size = 10, part = "all") %>%
theme_vanilla() %>%
width(width = dim(.)$widths * page_width /(flextable_dim(.)$widths)) %>%
align(align="center", part="all") %>%
autofit()
return(ftout)
}
run_num <- run_autonum(seq_id = "fig", pre_label = "图")
run_num_t <- run_autonum(seq_id = "table", pre_label = "表")
img_width1 = 6.5
img_width2 = 3.25
table_width = 6.5
# set_flextable_defaults(
#   font.family = "Calibri", font.size = 10, font.color = "black",
#   text.align = "centered")
#   # theme_fun = "theme_vanilla")
weekly_report <- read_docx(path = "word_reports/template1.docx") %>%
body_add_par("周会", style = "Title") %>%
body_add_par("目录", style = "centered") %>%
body_add_toc(level = 3) %>%
body_add_break() %>%
body_add_par("一、主要资产类别回顾", style = "heading 1") %>%
body_add_caption(block_caption("主要资产近一周涨跌幅汇总",
style = "chart1",
autonum = run_num)) %>%
body_add_img(src = "materials/主要资产类别回顾.png",
width = 7.5, height = 7.65,
style = "centered") %>%
body_add_break()
# 2. 板块回顾---------------------------------------------------------------------
## 2.1 指数回顾 -------------------------------------------------------------
weekly_report <- weekly_report %>%
body_add_par("二. 主要板块回顾", style = "heading 1") %>%
body_add_par("1. 全市场概览", style = "heading 2") %>%
body_add_par("1) 指数回顾", style = "heading 3") %>%
body_add_caption(block_caption("收益与估值",
style = "chart1",
autonum = run_num)) %>%
add_graph(Market$plot1, Market$plot2, img_width1, 3, "centered") %>%
add_graph(Market$plot3, Market$plot4, img_width1, 3, "centered") %>%
body_add_par("2) 分组数据概览", style = "heading 3") %>%
add_table(Market$summary1[1], "", "", table_width, "按类别分组",
table_style = "table1", table_num = run_num_t, type=1) %>%
add_table(Market$summary2[1], "", "", table_width, "按综合评级分组",
table_style = "table1", table_num = run_num_t, type=1)
# 3. 输出 -------------------------------------------------------------------
print(weekly_report, target = "word_reports/test.docx")
tran_kable1(Market$summary2[1], 6.5)
run_num <- run_autonum(seq_id = "fig", pre_label = "图")
run_num_t <- run_autonum(seq_id = "table", pre_label = "表")
img_width1 = 6.5
img_width2 = 3.25
table_width = 6.5
# set_flextable_defaults(
#   font.family = "Calibri", font.size = 10, font.color = "black",
#   text.align = "centered")
#   # theme_fun = "theme_vanilla")
weekly_report <- read_docx(path = "word_reports/template1.docx") %>%
body_add_par("周会", style = "Title") %>%
body_add_par("目录", style = "centered") %>%
body_add_toc(level = 3) %>%
body_add_break() %>%
body_add_par("一、主要资产类别回顾", style = "heading 1") %>%
body_add_caption(block_caption("主要资产近一周涨跌幅汇总",
style = "chart1",
autonum = run_num)) %>%
body_add_img(src = "materials/主要资产类别回顾.png",
width = 7.5, height = 7.65,
style = "centered") %>%
body_add_break()
# 2. 板块回顾---------------------------------------------------------------------
## 2.1 指数回顾 -------------------------------------------------------------
weekly_report <- weekly_report %>%
body_add_par("二. 主要板块回顾", style = "heading 1") %>%
body_add_par("1. 全市场概览", style = "heading 2") %>%
body_add_par("1) 指数回顾", style = "heading 3") %>%
body_add_caption(block_caption("收益与估值",
style = "chart1",
autonum = run_num)) %>%
add_graph(Market$plot1, Market$plot2, img_width1, 3, "centered") %>%
add_graph(Market$plot3, Market$plot4, img_width1, 3, "centered") %>%
body_add_par("2) 分组数据概览", style = "heading 3") %>%
add_table(Market$summary1[1], "", "", table_width, "按类别分组",
table_style = "table1", table_num = run_num_t, type=1) %>%
add_table(Market$summary2[1], "", "", table_width, "按综合评级分组",
table_style = "table1", table_num = run_num_t, type=1) %>%
add_table(Market$top[1], Market$top_MTD[1], Market$top_YTD[1],
table_width, "涨幅前十", "table1", run_num_t, 2)
run_num <- run_autonum(seq_id = "fig", pre_label = "图")
run_num_t <- run_autonum(seq_id = "table", pre_label = "表")
img_width1 = 6.5
img_width2 = 3.25
table_width = 6.5
# set_flextable_defaults(
#   font.family = "Calibri", font.size = 10, font.color = "black",
#   text.align = "centered")
#   # theme_fun = "theme_vanilla")
weekly_report <- read_docx(path = "word_reports/template1.docx") %>%
body_add_par("周会", style = "Title") %>%
body_add_par("目录", style = "centered") %>%
body_add_toc(level = 3) %>%
body_add_break() %>%
body_add_par("一、主要资产类别回顾", style = "heading 1") %>%
body_add_caption(block_caption("主要资产近一周涨跌幅汇总",
style = "chart1",
autonum = run_num)) %>%
body_add_img(src = "materials/主要资产类别回顾.png",
width = 7.5, height = 7.65,
style = "centered") %>%
body_add_break()
# 2. 板块回顾---------------------------------------------------------------------
## 2.1 指数回顾 -------------------------------------------------------------
weekly_report <- weekly_report %>%
body_add_par("二. 主要板块回顾", style = "heading 1") %>%
body_add_par("1. 全市场概览", style = "heading 2") %>%
body_add_par("1) 指数回顾", style = "heading 3") %>%
body_add_caption(block_caption("收益与估值",
style = "chart1",
autonum = run_num)) %>%
add_graph(Market$plot1, Market$plot2, img_width1, 3, "centered") %>%
add_graph(Market$plot3, Market$plot4, img_width1, 3, "centered") %>%
body_add_par("2) 分组数据概览", style = "heading 3") %>%
add_table(Market$summary1[1], "", "", table_width, "按类别分组",
table_style = "table1", table_num = run_num_t, type=1) %>%
add_table(Market$summary2[1], "", "", table_width, "按综合评级分组",
table_style = "table1", table_num = run_num_t, type=1) %>%
add_table(Market$top[1], Market$top_MTD[1], Market$top_YTD[1],
table_width, "涨幅前十", "table1", run_num_t, 2)
# 把涨跌幅排名周月年合并后的表格转化成flextable
# html_w = Market$bottom[1]
# html_m = Market$bottom_MTD[1]
# html_y = Market$bottom_YTD[1]
tran_kable_top_bot <- function(html_w, html_m, html_y, page_width) {
ftout <- summary_wmy(html_w, html_m, html_y) %>%
flextable() %>%
color(~ price_chg < 0, color = "red", ~ price_chg) %>%
color(~ price_chg > 0, color = "#008000", ~ price_chg) %>%
color(~ price_MTD < 0, color = "red", ~ price_MTD) %>%
color(~ price_MTD > 0, color = "#008000", ~ price_MTD) %>%
color(~ price_YTD < 0, color = "red", ~ price_YTD) %>%
color(~ price_YTD > 0, color = "#008000", ~ price_YTD) %>%
color(~ spread_chg < 0, color = "red", ~ spread_chg) %>%
color(~ spread_chg > 0, color = "#008000", ~ spread_chg) %>%
color(~ spread_MTD < 0, color = "red", ~ spread_MTD) %>%
color(~ spread_MTD > 0, color = "#008000", ~ spread_MTD) %>%
color(~ spread_YTD < 0, color = "red", ~ spread_YTD) %>%
color(~ spread_YTD > 0, color = "#008000", ~ spread_YTD) %>%
set_header_labels(Name...1 = "债券简称", Name...4 = "债券简称", Name...7 = "债券简称",
price_chg = "涨跌幅", price_MTD = "涨跌幅", price_YTD = "涨跌幅",
spread_chg = "信用利差变化", spread_MTD = "信用利差变化", spread_YTD = "信用利差变化") %>%
add_header_row(values = c("", "本周", "本周", "", "本月", "本月", "", "本年", "本年"), top = FALSE) %>%
merge_at(i = 2, j = 2:3, part = "header") %>%
merge_at(i = 2, j = 5:6, part = "header") %>%
merge_at(i = 2, j = 8:9, part = "header") %>%
font(fontname = "Microsoft YaHei", part = "header") %>%
font(fontname = "Calibri", part = "body") %>%
fontsize(size = 10, part = "all") %>%
bold(j = c(2, 3, 5, 6, 8, 9), bold = TRUE) %>%
bold(part = "header", bold = TRUE) %>%
theme_vanilla() %>%
width(width = dim(.)$widths * page_width /(flextable_dim(.)$widths)) %>%
align(align="center", part="all") %>%
autofit()
return(ftout)
}
# 新增type1是summary类表格，type2是matrix类表格
add_table <- function(weekly_report, html_w, html_m, html_y, table_width, caption_title,
table_style, table_num, type=1) {
if (type==1) {ftout <- tran_kable1(html_w, table_width)}
if (type==2) {ft <- tran_kable_top_bot(html_w, html_m, html_y, table_width)}
weekly_report <- weekly_report %>%
body_add_caption(block_caption(caption_title,
style = table_style,
autonum = table_num)) %>%
body_add_flextable(value = ftout)
}
tran_kable_top_bot(Market$top[1], Market$top_MTD[1], Market$top_YTD[1])
tran_kable_top_bot(Market$top[1], Market$top_MTD[1], Market$top_YTD[1]， 6.5)
tran_kable_top_bot(Market$top[1], Market$top_MTD[1], Market$top_YTD[1], 6.5)
run_num <- run_autonum(seq_id = "fig", pre_label = "图")
run_num_t <- run_autonum(seq_id = "table", pre_label = "表")
img_width1 = 6.5
img_width2 = 3.25
table_width = 6.5
# set_flextable_defaults(
#   font.family = "Calibri", font.size = 10, font.color = "black",
#   text.align = "centered")
#   # theme_fun = "theme_vanilla")
weekly_report <- read_docx(path = "word_reports/template1.docx") %>%
body_add_par("周会", style = "Title") %>%
body_add_par("目录", style = "centered") %>%
body_add_toc(level = 3) %>%
body_add_break() %>%
body_add_par("一、主要资产类别回顾", style = "heading 1") %>%
body_add_caption(block_caption("主要资产近一周涨跌幅汇总",
style = "chart1",
autonum = run_num)) %>%
body_add_img(src = "materials/主要资产类别回顾.png",
width = 7.5, height = 7.65,
style = "centered") %>%
body_add_break()
# 2. 板块回顾---------------------------------------------------------------------
## 2.1 指数回顾 -------------------------------------------------------------
weekly_report <- weekly_report %>%
body_add_par("二. 主要板块回顾", style = "heading 1") %>%
body_add_par("1. 全市场概览", style = "heading 2") %>%
body_add_par("1) 指数回顾", style = "heading 3") %>%
body_add_caption(block_caption("收益与估值",
style = "chart1",
autonum = run_num)) %>%
add_graph(Market$plot1, Market$plot2, img_width1, 3, "centered") %>%
add_graph(Market$plot3, Market$plot4, img_width1, 3, "centered") %>%
body_add_par("2) 分组数据概览", style = "heading 3") %>%
add_table(Market$summary1[1], "", "", table_width, "按类别分组",
table_style = "table1", table_num = run_num_t, type=1) %>%
add_table(Market$summary2[1], "", "", table_width, "按综合评级分组",
table_style = "table1", table_num = run_num_t, type=1) %>%
add_table(Market$top[1], Market$top_MTD[1], Market$top_YTD[1],
table_width, "涨幅前十", "table1", run_num_t, 2)
# 3. 输出 -------------------------------------------------------------------
print(weekly_report, target = "word_reports/test.docx")
# 新增type1是summary类表格，type2是matrix类表格
add_table <- function(weekly_report, html_w, html_m, html_y, table_width, caption_title,
table_style, table_num, type=1) {
if (type==1) {ftout <- tran_kable1(html_w, table_width)}
if (type==2) {ftout <- tran_kable_top_bot(html_w, html_m, html_y, table_width)}
weekly_report <- weekly_report %>%
body_add_caption(block_caption(caption_title,
style = table_style,
autonum = table_num)) %>%
body_add_flextable(value = ftout)
}
run_num <- run_autonum(seq_id = "fig", pre_label = "图")
run_num_t <- run_autonum(seq_id = "table", pre_label = "表")
img_width1 = 6.5
img_width2 = 3.25
table_width = 6.5
# set_flextable_defaults(
#   font.family = "Calibri", font.size = 10, font.color = "black",
#   text.align = "centered")
#   # theme_fun = "theme_vanilla")
weekly_report <- read_docx(path = "word_reports/template1.docx") %>%
body_add_par("周会", style = "Title") %>%
body_add_par("目录", style = "centered") %>%
body_add_toc(level = 3) %>%
body_add_break() %>%
body_add_par("一、主要资产类别回顾", style = "heading 1") %>%
body_add_caption(block_caption("主要资产近一周涨跌幅汇总",
style = "chart1",
autonum = run_num)) %>%
body_add_img(src = "materials/主要资产类别回顾.png",
width = 7.5, height = 7.65,
style = "centered") %>%
body_add_break()
# 2. 板块回顾---------------------------------------------------------------------
## 2.1 指数回顾 -------------------------------------------------------------
weekly_report <- weekly_report %>%
body_add_par("二. 主要板块回顾", style = "heading 1") %>%
body_add_par("1. 全市场概览", style = "heading 2") %>%
body_add_par("1) 指数回顾", style = "heading 3") %>%
body_add_caption(block_caption("收益与估值",
style = "chart1",
autonum = run_num)) %>%
add_graph(Market$plot1, Market$plot2, img_width1, 3, "centered") %>%
add_graph(Market$plot3, Market$plot4, img_width1, 3, "centered") %>%
body_add_par("2) 分组数据概览", style = "heading 3") %>%
add_table(Market$summary1[1], "", "", table_width, "按类别分组",
table_style = "table1", table_num = run_num_t, type=1) %>%
add_table(Market$summary2[1], "", "", table_width, "按综合评级分组",
table_style = "table1", table_num = run_num_t, type=1) %>%
add_table(Market$top[1], Market$top_MTD[1], Market$top_YTD[1],
table_width, "涨幅前十", "table1", run_num_t, 2)
# 3. 输出 -------------------------------------------------------------------
print(weekly_report, target = "word_reports/test.docx")
ftout <- tran_kable_top_bot(Market$top[1], Market$top_MTD[1], Market$top_YTD[1], table_width)
ftout
dims(ftout)
dim(ftout)
flextable_dim(ftout)
html_w = Market$bottom[1]
html_m = Market$bottom_MTD[1]
html_y = Market$bottom_YTD[1]
ftout <- summary_wmy(html_w, html_m, html_y) %>%
flextable() %>%
color(~ price_chg < 0, color = "red", ~ price_chg) %>%
color(~ price_chg > 0, color = "#008000", ~ price_chg) %>%
color(~ price_MTD < 0, color = "red", ~ price_MTD) %>%
color(~ price_MTD > 0, color = "#008000", ~ price_MTD) %>%
color(~ price_YTD < 0, color = "red", ~ price_YTD) %>%
color(~ price_YTD > 0, color = "#008000", ~ price_YTD) %>%
color(~ spread_chg < 0, color = "red", ~ spread_chg) %>%
color(~ spread_chg > 0, color = "#008000", ~ spread_chg) %>%
color(~ spread_MTD < 0, color = "red", ~ spread_MTD) %>%
color(~ spread_MTD > 0, color = "#008000", ~ spread_MTD) %>%
color(~ spread_YTD < 0, color = "red", ~ spread_YTD) %>%
color(~ spread_YTD > 0, color = "#008000", ~ spread_YTD) %>%
set_header_labels(Name...1 = "债券简称", Name...4 = "债券简称", Name...7 = "债券简称",
price_chg = "涨跌幅", price_MTD = "涨跌幅", price_YTD = "涨跌幅",
spread_chg = "信用利差变化", spread_MTD = "信用利差变化", spread_YTD = "信用利差变化") %>%
add_header_row(values = c("", "本周", "本周", "", "本月", "本月", "", "本年", "本年"), top = FALSE) %>%
merge_at(i = 2, j = 2:3, part = "header") %>%
merge_at(i = 2, j = 5:6, part = "header") %>%
merge_at(i = 2, j = 8:9, part = "header") %>%
font(fontname = "Microsoft YaHei", part = "header") %>%
font(fontname = "Calibri", part = "body") %>%
fontsize(size = 10, part = "all") %>%
bold(j = c(2, 3, 5, 6, 8, 9), bold = TRUE) %>%
bold(part = "header", bold = TRUE) %>%
theme_vanilla() %>%
width(width = dim(.)$widths * page_width /(flextable_dim(.)$widths)) %>%
align(align="center", part="all") %>%
autofit()
ftout
dim(ftout)
flextable_dim(ftout)
page_width
page_width /(flextable_dim(.)$widths)
page_width /(flextable_dim(.)$widths)
page_width /(flextable_dim(ftout)$widths)
page_width /(flextable_dim(ftout)$widths)
page_width /(flextable_dim(ftout)$widths) * dim(ftout)$widths
sum(page_width /(flextable_dim(ftout)$widths) * dim(ftout)$widths)
tran_kable_top_bot <- function(html_w, html_m, html_y, page_width) {
ftout <- summary_wmy(html_w, html_m, html_y) %>%
flextable() %>%
color(~ price_chg < 0, color = "red", ~ price_chg) %>%
color(~ price_chg > 0, color = "#008000", ~ price_chg) %>%
color(~ price_MTD < 0, color = "red", ~ price_MTD) %>%
color(~ price_MTD > 0, color = "#008000", ~ price_MTD) %>%
color(~ price_YTD < 0, color = "red", ~ price_YTD) %>%
color(~ price_YTD > 0, color = "#008000", ~ price_YTD) %>%
color(~ spread_chg < 0, color = "red", ~ spread_chg) %>%
color(~ spread_chg > 0, color = "#008000", ~ spread_chg) %>%
color(~ spread_MTD < 0, color = "red", ~ spread_MTD) %>%
color(~ spread_MTD > 0, color = "#008000", ~ spread_MTD) %>%
color(~ spread_YTD < 0, color = "red", ~ spread_YTD) %>%
color(~ spread_YTD > 0, color = "#008000", ~ spread_YTD) %>%
set_header_labels(Name...1 = "债券简称", Name...4 = "债券简称", Name...7 = "债券简称",
price_chg = "涨跌幅", price_MTD = "涨跌幅", price_YTD = "涨跌幅",
spread_chg = "信用利差变化", spread_MTD = "信用利差变化", spread_YTD = "信用利差变化") %>%
add_header_row(values = c("", "本周", "本周", "", "本月", "本月", "", "本年", "本年"), top = FALSE) %>%
merge_at(i = 2, j = 2:3, part = "header") %>%
merge_at(i = 2, j = 5:6, part = "header") %>%
merge_at(i = 2, j = 8:9, part = "header") %>%
font(fontname = "Microsoft YaHei", part = "header") %>%
font(fontname = "Calibri", part = "body") %>%
fontsize(size = 10, part = "all") %>%
bold(j = c(2, 3, 5, 6, 8, 9), bold = TRUE) %>%
bold(part = "header", bold = TRUE) %>%
theme_vanilla() %>%
width(width = dim(.)$widths * page_width /(flextable_dim(.)$widths)) %>%
align(align="center", part="all")
# autofit()
return(ftout)
}
# 新增type1是summary类表格，type2是matrix类表格
add_table <- function(weekly_report, html_w, html_m, html_y, table_width, caption_title,
table_style, table_num, type=1) {
if (type==1) {ftout <- tran_kable1(html_w, table_width)}
if (type==2) {ftout <- tran_kable_top_bot(html_w, html_m, html_y, table_width)}
weekly_report <- weekly_report %>%
body_add_caption(block_caption(caption_title,
style = table_style,
autonum = table_num)) %>%
body_add_flextable(value = ftout)
}
run_num <- run_autonum(seq_id = "fig", pre_label = "图")
run_num_t <- run_autonum(seq_id = "table", pre_label = "表")
img_width1 = 6.5
img_width2 = 3.25
table_width = 6.5
# set_flextable_defaults(
#   font.family = "Calibri", font.size = 10, font.color = "black",
#   text.align = "centered")
#   # theme_fun = "theme_vanilla")
weekly_report <- read_docx(path = "word_reports/template1.docx") %>%
body_add_par("周会", style = "Title") %>%
body_add_par("目录", style = "centered") %>%
body_add_toc(level = 3) %>%
body_add_break() %>%
body_add_par("一、主要资产类别回顾", style = "heading 1") %>%
body_add_caption(block_caption("主要资产近一周涨跌幅汇总",
style = "chart1",
autonum = run_num)) %>%
body_add_img(src = "materials/主要资产类别回顾.png",
width = 7.5, height = 7.65,
style = "centered") %>%
body_add_break()
# 2. 板块回顾---------------------------------------------------------------------
## 2.1 指数回顾 -------------------------------------------------------------
weekly_report <- weekly_report %>%
body_add_par("二. 主要板块回顾", style = "heading 1") %>%
body_add_par("1. 全市场概览", style = "heading 2") %>%
body_add_par("1) 指数回顾", style = "heading 3") %>%
body_add_caption(block_caption("收益与估值",
style = "chart1",
autonum = run_num)) %>%
add_graph(Market$plot1, Market$plot2, img_width1, 3, "centered") %>%
add_graph(Market$plot3, Market$plot4, img_width1, 3, "centered") %>%
body_add_par("2) 分组数据概览", style = "heading 3") %>%
add_table(Market$summary1[1], "", "", table_width, "按类别分组",
table_style = "table1", table_num = run_num_t, type=1) %>%
add_table(Market$summary2[1], "", "", table_width, "按综合评级分组",
table_style = "table1", table_num = run_num_t, type=1) %>%
add_table(Market$top[1], Market$top_MTD[1], Market$top_YTD[1],
table_width, "涨幅前十", "table1", run_num_t, 2)
# 3. 输出 -------------------------------------------------------------------
print(weekly_report, target = "word_reports/test.docx")
run_num <- run_autonum(seq_id = "fig", pre_label = "图")
run_num_t <- run_autonum(seq_id = "table", pre_label = "表")
img_width1 = 6.5
img_width2 = 3.25
table_width = 6.5
# set_flextable_defaults(
#   font.family = "Calibri", font.size = 10, font.color = "black",
#   text.align = "centered")
#   # theme_fun = "theme_vanilla")
weekly_report <- read_docx(path = "word_reports/template1.docx") %>%
body_add_par("周会", style = "Title") %>%
body_add_par("目录", style = "centered") %>%
body_add_toc(level = 3) %>%
body_add_break() %>%
body_add_par("一、主要资产类别回顾", style = "heading 1") %>%
body_add_caption(block_caption("主要资产近一周涨跌幅汇总",
style = "chart1",
autonum = run_num)) %>%
body_add_img(src = "materials/主要资产类别回顾.png",
width = 7.5, height = 7.65,
style = "centered") %>%
body_add_break()
# 2. 板块回顾---------------------------------------------------------------------
## 2.1 指数回顾 -------------------------------------------------------------
weekly_report <- weekly_report %>%
body_add_par("二. 主要板块回顾", style = "heading 1") %>%
body_add_par("1. 全市场概览", style = "heading 2") %>%
body_add_par("1) 指数回顾", style = "heading 3") %>%
body_add_caption(block_caption("收益与估值",
style = "chart1",
autonum = run_num)) %>%
add_graph(Market$plot1, Market$plot2, img_width1, 3, "centered") %>%
add_graph(Market$plot3, Market$plot4, img_width1, 3, "centered") %>%
body_add_par("2) 分组数据概览", style = "heading 3") %>%
add_table(Market$summary1[1], "", "", table_width, "按类别分组",
table_style = "table1", table_num = run_num_t, type=1) %>%
add_table(Market$summary2[1], "", "", table_width, "按综合评级分组",
table_style = "table1", table_num = run_num_t, type=1) %>%
add_table(Market$top[1], Market$top_MTD[1], Market$top_YTD[1],
table_width, "涨幅前十", "table1", run_num_t, 2) %>%
add_table(Market$bottom[1], Market$bottom_MTD[1], Market$bottom_YTD[1],
table_width, "涨幅前十", "table1", run_num_t, 2)
# 3. 输出 -------------------------------------------------------------------
print(weekly_report, target = "word_reports/test.docx")
